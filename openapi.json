{"openapi":"3.1.0","info":{"title":"Auto Leadsheet API","description":"API for managing leadsheet generation jobs and songs","version":"0.1.0"},"paths":{"/jobs":{"post":{"tags":["jobs"],"summary":"Create New Job","description":"Create a new job.","operationId":"create_new_job_jobs_post","responses":{"201":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/JobResponse"}}}}},"security":[{"HTTPBearer":[]}]}},"/jobs/{job_id}":{"get":{"tags":["jobs"],"summary":"Get Job Details","description":"Get job details by ID.","operationId":"get_job_details_jobs__job_id__get","security":[{"HTTPBearer":[]}],"parameters":[{"name":"job_id","in":"path","required":true,"schema":{"type":"string","title":"Job Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/JobResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/jobs/{job_id}/status":{"get":{"tags":["jobs"],"summary":"Get Job Status","description":"Get job status by ID.","operationId":"get_job_status_jobs__job_id__status_get","security":[{"HTTPBearer":[]}],"parameters":[{"name":"job_id","in":"path","required":true,"schema":{"type":"string","title":"Job Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/JobStatusResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/jobs/{job_id}/run-allin1":{"post":{"tags":["jobs"],"summary":"Trigger Allin1 Job","description":"Trigger the allin1 analysis Cloud Run job. Returns immediately without waiting.","operationId":"trigger_allin1_job_jobs__job_id__run_allin1_post","security":[{"HTTPBearer":[]}],"parameters":[{"name":"job_id","in":"path","required":true,"schema":{"type":"string","title":"Job Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/RunJobResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/jobs/{job_id}/run-chord":{"post":{"tags":["jobs"],"summary":"Trigger Chord Job","description":"Trigger the chord analysis Cloud Run job. Returns immediately without waiting.","operationId":"trigger_chord_job_jobs__job_id__run_chord_post","security":[{"HTTPBearer":[]}],"parameters":[{"name":"job_id","in":"path","required":true,"schema":{"type":"string","title":"Job Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/RunJobResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/jobs/{job_id}/songs":{"get":{"tags":["songs"],"summary":"List Songs","description":"List all songs in a job.","operationId":"list_songs_jobs__job_id__songs_get","security":[{"HTTPBearer":[]}],"parameters":[{"name":"job_id","in":"path","required":true,"schema":{"type":"string","title":"Job Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/SongsListResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}},"post":{"tags":["songs"],"summary":"Create New Song","description":"Create a new song in a job.","operationId":"create_new_song_jobs__job_id__songs_post","security":[{"HTTPBearer":[]}],"parameters":[{"name":"job_id","in":"path","required":true,"schema":{"type":"string","title":"Job Id"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CreateSongRequest"}}}},"responses":{"201":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/SongResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/jobs/{job_id}/songs/{song_id}":{"get":{"tags":["songs"],"summary":"Get Song Details","description":"Get song details by ID.","operationId":"get_song_details_jobs__job_id__songs__song_id__get","security":[{"HTTPBearer":[]}],"parameters":[{"name":"song_id","in":"path","required":true,"schema":{"type":"string","title":"Song Id"}},{"name":"job_id","in":"path","required":true,"schema":{"type":"string","title":"Job Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/SongResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}},"delete":{"tags":["songs"],"summary":"Delete Song Endpoint","description":"Delete a song and all its associated files from GCS.\n\nRemoves the song document from Firestore and deletes the song\ndirectory under both the input and output bucket prefixes.","operationId":"delete_song_endpoint_jobs__job_id__songs__song_id__delete","security":[{"HTTPBearer":[]}],"parameters":[{"name":"job_id","in":"path","required":true,"schema":{"type":"string","title":"Job Id"}},{"name":"song_id","in":"path","required":true,"schema":{"type":"string","title":"Song Id"}}],"responses":{"204":{"description":"Successful Response"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}},"patch":{"tags":["songs"],"summary":"Update Song Endpoint","description":"Update song metadata.\n\nOnly the fields provided in the request body will be updated.\nOmitted (null) fields are left unchanged.","operationId":"update_song_endpoint_jobs__job_id__songs__song_id__patch","security":[{"HTTPBearer":[]}],"parameters":[{"name":"job_id","in":"path","required":true,"schema":{"type":"string","title":"Job Id"}},{"name":"song_id","in":"path","required":true,"schema":{"type":"string","title":"Song Id"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UpdateSongRequest"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/SongResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/jobs/{job_id}/songs/{song_id}/status":{"get":{"tags":["songs"],"summary":"Get Song Status","description":"Get song status by ID.","operationId":"get_song_status_jobs__job_id__songs__song_id__status_get","security":[{"HTTPBearer":[]}],"parameters":[{"name":"song_id","in":"path","required":true,"schema":{"type":"string","title":"Song Id"}},{"name":"job_id","in":"path","required":true,"schema":{"type":"string","title":"Job Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/SongStatusResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/jobs/{job_id}/songs/{song_id}/upload-url":{"get":{"tags":["songs"],"summary":"Get Upload Url","description":"Get a signed URL for uploading audio to this song.\n\nThe signed URL is valid for 15 minutes and should be used with a PUT request.","operationId":"get_upload_url_jobs__job_id__songs__song_id__upload_url_get","security":[{"HTTPBearer":[]}],"parameters":[{"name":"song_id","in":"path","required":true,"schema":{"type":"string","title":"Song Id"}},{"name":"job_id","in":"path","required":true,"schema":{"type":"string","title":"Job Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/UploadUrlResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/jobs/{job_id}/songs/{song_id}/upload-status":{"patch":{"tags":["songs"],"summary":"Update Upload Status","description":"Update the upload status of a song.\n\nCalled by the client after a file upload completes (or fails) via the\nsigned URL so the backend can track progress.","operationId":"update_upload_status_jobs__job_id__songs__song_id__upload_status_patch","security":[{"HTTPBearer":[]}],"parameters":[{"name":"job_id","in":"path","required":true,"schema":{"type":"string","title":"Job Id"}},{"name":"song_id","in":"path","required":true,"schema":{"type":"string","title":"Song Id"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UpdateUploadStatusRequest"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/SongResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/jobs/{job_id}/songs/{song_id}/sheet.musicxml":{"get":{"tags":["songs"],"summary":"Get Song Musicxml","description":"Get the MusicXML lead sheet for a song.\n\nGenerates the file on the first request and caches it in GCS for\nsubsequent requests.","operationId":"get_song_musicxml_jobs__job_id__songs__song_id__sheet_musicxml_get","security":[{"HTTPBearer":[]}],"parameters":[{"name":"job_id","in":"path","required":true,"schema":{"type":"string","title":"Job Id"}},{"name":"song_id","in":"path","required":true,"schema":{"type":"string","title":"Song Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/jobs/{job_id}/songs/{song_id}/sheet.pdf":{"get":{"tags":["songs"],"summary":"Get Song Pdf","description":"Get the PDF lead sheet for a song.\n\nGenerates the file on the first request and caches it in GCS for\nsubsequent requests.","operationId":"get_song_pdf_jobs__job_id__songs__song_id__sheet_pdf_get","security":[{"HTTPBearer":[]}],"parameters":[{"name":"job_id","in":"path","required":true,"schema":{"type":"string","title":"Job Id"}},{"name":"song_id","in":"path","required":true,"schema":{"type":"string","title":"Song Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/health":{"get":{"tags":["health"],"summary":"Health Check","description":"Health check endpoint for Cloud Run readiness probes.","operationId":"health_check_health_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HealthResponse"}}}}}}}},"components":{"schemas":{"CreateSongRequest":{"properties":{"title":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Title"},"artist":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Artist"},"originalName":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Originalname"},"fileType":{"type":"string","title":"Filetype","default":"mp3"}},"type":"object","title":"CreateSongRequest","description":"Request model for creating a song."},"HTTPValidationError":{"properties":{"detail":{"items":{"$ref":"#/components/schemas/ValidationError"},"type":"array","title":"Detail"}},"type":"object","title":"HTTPValidationError"},"HealthResponse":{"properties":{"status":{"type":"string","title":"Status","default":"ok"}},"type":"object","title":"HealthResponse","description":"Response model for health check."},"JobResponse":{"properties":{"jobId":{"type":"string","title":"Jobid"},"createdAt":{"type":"string","format":"date-time","title":"Createdat"},"updatedAt":{"type":"string","format":"date-time","title":"Updatedat"},"status":{"$ref":"#/components/schemas/JobStatusEnum"},"allin1Execution":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Allin1Execution"},"chordExecution":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Chordexecution"}},"type":"object","required":["jobId","createdAt","updatedAt","status"],"title":"JobResponse","description":"Response model for a job."},"JobStatusEnum":{"type":"string","enum":["PENDING","UPLOADING","ANALYZING","FAILED","CANCELLED","SUCCESS"],"title":"JobStatusEnum","description":"Status values for a job or song."},"JobStatusResponse":{"properties":{"jobId":{"type":"string","title":"Jobid"},"status":{"$ref":"#/components/schemas/JobStatusEnum"}},"type":"object","required":["jobId","status"],"title":"JobStatusResponse","description":"Response model for job status only."},"RunJobResponse":{"properties":{"jobId":{"type":"string","title":"Jobid"},"executionId":{"type":"string","title":"Executionid"}},"type":"object","required":["jobId","executionId"],"title":"RunJobResponse","description":"Response after triggering a Cloud Run job."},"SongResponse":{"properties":{"songId":{"type":"string","title":"Songid"},"uploadStatus":{"$ref":"#/components/schemas/UploadStatusEnum"},"chordStatus":{"$ref":"#/components/schemas/JobStatusEnum"},"allin1Status":{"$ref":"#/components/schemas/JobStatusEnum"},"title":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Title"},"artist":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Artist"},"audioPath":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Audiopath"},"chordsPath":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Chordspath"},"allin1Path":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Allin1Path"},"xmlPath":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Xmlpath"},"pdfPath":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Pdfpath"},"size":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Size"},"length":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Length"},"originalName":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Originalname"},"preview":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Preview"}},"type":"object","required":["songId","uploadStatus","chordStatus","allin1Status"],"title":"SongResponse","description":"Response model for a song."},"SongStatusResponse":{"properties":{"songId":{"type":"string","title":"Songid"},"chordStatus":{"$ref":"#/components/schemas/JobStatusEnum"},"allin1Status":{"$ref":"#/components/schemas/JobStatusEnum"}},"type":"object","required":["songId","chordStatus","allin1Status"],"title":"SongStatusResponse","description":"Response model for song status only."},"SongsListResponse":{"properties":{"jobId":{"type":"string","title":"Jobid"},"songs":{"items":{"$ref":"#/components/schemas/SongResponse"},"type":"array","title":"Songs"}},"type":"object","required":["jobId","songs"],"title":"SongsListResponse","description":"Response model for a list of songs."},"UpdateSongRequest":{"properties":{"title":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Title"},"artist":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Artist"},"size":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Size"},"length":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Length"}},"type":"object","title":"UpdateSongRequest","description":"Request model for updating song metadata.\n\nAll fields are optional; only provided fields will be updated."},"UpdateUploadStatusRequest":{"properties":{"uploadStatus":{"$ref":"#/components/schemas/UploadStatusEnum"}},"type":"object","required":["uploadStatus"],"title":"UpdateUploadStatusRequest","description":"Request model for updating a song's upload status."},"UploadStatusEnum":{"type":"string","enum":["PENDING","UPLOADING","ERROR","SUCCESS"],"title":"UploadStatusEnum","description":"Status values for audio file upload."},"UploadUrlResponse":{"properties":{"songId":{"type":"string","title":"Songid"},"uploadUrl":{"type":"string","title":"Uploadurl"},"audioPath":{"type":"string","title":"Audiopath"},"contentType":{"type":"string","title":"Contenttype"},"expiresInMinutes":{"type":"integer","title":"Expiresinminutes","default":15}},"type":"object","required":["songId","uploadUrl","audioPath","contentType"],"title":"UploadUrlResponse","description":"Response model for upload URL."},"ValidationError":{"properties":{"loc":{"items":{"anyOf":[{"type":"string"},{"type":"integer"}]},"type":"array","title":"Location"},"msg":{"type":"string","title":"Message"},"type":{"type":"string","title":"Error Type"},"input":{"title":"Input"},"ctx":{"type":"object","title":"Context"}},"type":"object","required":["loc","msg","type"],"title":"ValidationError"}},"securitySchemes":{"HTTPBearer":{"type":"http","scheme":"bearer"}}}}